apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: cloudnative-pg

labels:
  - pairs:
      app.kubernetes.io/name: cloudnative-pg
      app.kubernetes.io/component: cloudnative-pg-operator
      app.kubernetes.io/part-of: infrastructure
      app.kubernetes.io/managed-by: argocd
    

resources:
  - rbac.yaml

helmCharts:
  - name: cloudnative-pg
    repo: https://cloudnative-pg.github.io/charts
    version: 0.26.1
    releaseName: cloudnative-pg-operator
    namespace: cloudnative-pg
    valuesFile: values.yaml
    includeCRDs: true

# Find solution to override only PodMonitor sync wave
# Issue: https://github.com/kubernetes-sigs/kustomize/issues/3046
# patchesJson6902:
#   - target:
#       group: monitoring.coreos.com
#       version: v1
#       kind: PodMonitor
#       name: .*
#       namespace: cloudnative-pg
#     patch: |
#       - op: replace
#         path: /metadata/annotations/argocd.argoproj.io~1sync-wave
#         value: "3"